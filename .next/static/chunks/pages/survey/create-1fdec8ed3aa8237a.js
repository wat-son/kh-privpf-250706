(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[273],{5261:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/survey/create",function(){return t(7271)}])},7271:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return SurveyCreatePage}});var i=t(1010),r=t(2253),o=t(1309),u=t(4586),a=t(7582),s=t(5893),c=t(7294),l=t(6452),d=t(824),h=t(9258),p=t(1395),f=t(8887),x=t(7548),v=t(4966),j=t(5900),Z=t(9915),m=t(2467),b=t(2178),g=t(1266),y=t(5777),k=t(7946),_=t(4545),C=t(1959),makeId=function(){return"undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():"".concat(Date.now(),"_").concat(Math.random().toString(36).slice(2,8))},w="nqK52fj4toaE4vqLOYvEw2vHwwdzI3pt2QJCKalG";function SurveyCreatePage(){var e,n=(0,o._)((0,c.useState)(""),2),t=n[0],O=n[1],Q=(0,o._)((0,c.useState)(""),2),S=Q[0],I=Q[1],q=(0,o._)((0,c.useState)("draft"),2),E=q[0],N=q[1],D=(0,o._)((0,c.useState)([]),2),P=D[0],W=D[1],addQuestion=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"text";W(function(n){return(0,u._)(n).concat([{id:makeId(),type:e,label:"",required:!1,options:"radio"===e||"select"===e||"checkbox"===e?["選択肢1"]:void 0}])})},updateQuestion=function(e,n){return W(function(t){return t.map(function(t){return t.id===e?(0,r._)({},t,n):t})})},addOption=function(e){var n,t;return updateQuestion(e,{options:(0,u._)(null!==(t=null===(n=P.find(function(n){return n.id===e}))||void 0===n?void 0:n.options)&&void 0!==t?t:[]).concat([""])})},updateOption=function(e,n,t){var i=P.find(function(n){return n.id===e});if(i&&i.options){var r=(0,u._)(i.options);r[n]=t,updateQuestion(e,{options:r})}},removeOption=function(e,n){var t=P.find(function(n){return n.id===e});t&&t.options&&updateQuestion(e,{options:t.options.filter(function(e,t){return t!==n})})},J=(e=(0,i._)(function(e){var n,i,o,u;return(0,a.Jh)(this,function(a){switch(a.label){case 0:if(e.preventDefault(),!t.trim())return alert("タイトルを入力してください"),[2];n={surveyId:makeId(),title:t,description:S,status:E,questions:P,createdAt:new Date().toISOString()},a.label=1;case 1:return a.trys.push([1,6,,7]),[4,fetch("".concat("https://iwy9oz1bf0.execute-api.us-east-1.amazonaws.com/dev","/surveys"),{method:"POST",headers:(0,r._)({"Content-Type":"application/json"},w?{"x-api-key":w}:{}),body:JSON.stringify(n)})];case 2:if((i=a.sent()).ok)return[3,4];return[4,i.text()];case 3:return o=a.sent(),console.error("非OK",i.status,o),alert("保存に失敗しました"),[2];case 4:return[4,i.json()];case 5:return u=a.sent(),alert("保存しました: "+JSON.stringify(u)),O(""),I(""),W([]),[3,7];case 6:return console.error(a.sent()),alert("通信エラー"),[3,7];case 7:return[2]}})}),function(n){return e.apply(this,arguments)});return(0,s.jsxs)(l.Z,{maxWidth:"md",sx:{mt:6},children:[(0,s.jsx)(d.Z,{variant:"h4",gutterBottom:!0,children:"アンケート作成"}),(0,s.jsxs)(h.Z,{component:"form",onSubmit:J,sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,s.jsx)(p.Z,{label:"タイトル",value:t,onChange:function(e){return O(e.target.value)},required:!0}),(0,s.jsx)(p.Z,{label:"説明",value:S,onChange:function(e){return I(e.target.value)},multiline:!0,rows:3}),(0,s.jsxs)(f.Z,{fullWidth:!0,children:[(0,s.jsx)(x.Z,{id:"status-label",children:"状態"}),(0,s.jsxs)(v.Z,{labelId:"status-label",value:E,label:"状態",onChange:function(e){return N(e.target.value)},children:[(0,s.jsx)(j.Z,{value:"draft",children:"下書き"}),(0,s.jsx)(j.Z,{value:"published",children:"公開"})]})]}),(0,s.jsxs)(Z.Z,{direction:"row",spacing:1,children:[(0,s.jsx)(m.Z,{startIcon:(0,s.jsx)(_.Z,{}),onClick:function(){return addQuestion("text")},children:"自由記入"}),(0,s.jsx)(m.Z,{onClick:function(){return addQuestion("textarea")},children:"長文"}),(0,s.jsx)(m.Z,{onClick:function(){return addQuestion("radio")},children:"単一選択"}),(0,s.jsx)(m.Z,{onClick:function(){return addQuestion("checkbox")},children:"複数選択"}),(0,s.jsx)(m.Z,{onClick:function(){return addQuestion("select")},children:"ドロップダウン"})]}),(0,s.jsx)(Z.Z,{spacing:2,children:P.map(function(e,n){var t,i;return(0,s.jsxs)(b.Z,{sx:{p:2,position:"relative"},children:[(0,s.jsx)(g.Z,{onClick:function(){var n;return n=e.id,W(function(e){return e.filter(function(e){return e.id!==n})})},sx:{position:"absolute",right:8,top:8},children:(0,s.jsx)(C.Z,{})}),(0,s.jsx)(f.Z,{fullWidth:!0,sx:{mb:1},children:(0,s.jsx)(p.Z,{label:"質問 ".concat(n+1," のラベル"),value:e.label,onChange:function(n){return updateQuestion(e.id,{label:n.target.value})}})}),(0,s.jsxs)(f.Z,{sx:{minWidth:180},children:[(0,s.jsx)(x.Z,{id:"type-".concat(e.id),children:"タイプ"}),(0,s.jsxs)(v.Z,{labelId:"type-".concat(e.id),value:e.type,label:"タイプ",onChange:function(n){var t,i=n.target.value;updateQuestion(e.id,{type:i,options:"radio"===i||"select"===i||"checkbox"===i?null!==(t=e.options)&&void 0!==t?t:["選択肢1"]:void 0})},children:[(0,s.jsx)(j.Z,{value:"text",children:"短文（1行）"}),(0,s.jsx)(j.Z,{value:"textarea",children:"長文（複数行）"}),(0,s.jsx)(j.Z,{value:"radio",children:"単一選択"}),(0,s.jsx)(j.Z,{value:"checkbox",children:"複数選択"}),(0,s.jsx)(j.Z,{value:"select",children:"ドロップダウン"}),(0,s.jsx)(j.Z,{value:"rating",children:"評価（星）"})]})]}),(0,s.jsx)(y.Z,{control:(0,s.jsx)(k.Z,{checked:null!==(t=e.required)&&void 0!==t&&t,onChange:function(n){return updateQuestion(e.id,{required:n.target.checked})}}),label:"必須"}),("radio"===e.type||"select"===e.type||"checkbox"===e.type)&&(0,s.jsxs)(h.Z,{sx:{mt:1},children:[(0,s.jsx)(d.Z,{variant:"subtitle2",children:"選択肢"}),(null!==(i=e.options)&&void 0!==i?i:[]).map(function(n,t){return(0,s.jsxs)(Z.Z,{direction:"row",spacing:1,alignItems:"center",sx:{mt:1},children:[(0,s.jsx)(p.Z,{value:n,onChange:function(n){return updateOption(e.id,t,n.target.value)},fullWidth:!0}),(0,s.jsx)(m.Z,{variant:"outlined",onClick:function(){return removeOption(e.id,t)},children:"削除"})]},t)}),(0,s.jsx)(m.Z,{sx:{mt:1},onClick:function(){return addOption(e.id)},children:"選択肢を追加"})]})]},e.id)})}),(0,s.jsxs)(h.Z,{sx:{display:"flex",gap:2},children:[(0,s.jsx)(m.Z,{type:"submit",variant:"contained",children:"保存して公開"}),(0,s.jsx)(m.Z,{variant:"outlined",onClick:function(){O(""),I(""),W([])},children:"クリア"})]})]})]})}}},function(e){e.O(0,[880,53,774,888,179],function(){return e(e.s=5261)}),_N_E=e.O()}]);